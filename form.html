<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event Registration - CHRIS TECH 2026</title>
  <style>
    /* (Same styles as you provided) */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#0a0e27 0%,#1a1f3a 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .main-container{display:flex;max-width:1400px;width:100%;background:#0f1320;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.6),0 0 80px rgba(0,255,255,.1);overflow:hidden;min-height:700px;border:1px solid rgba(0,255,255,.2)}
    .left-panel{flex:1;background:linear-gradient(135deg,#00d4ff 0%,#0099ff 25%,#0066ff 50%,#0044cc 75%,#002299 100%);display:flex;align-items:center;justify-content:center;padding:60px 40px;position:relative;overflow:hidden}
    .left-panel::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background: radial-gradient(circle at 20% 30%, rgba(0,255,255,.3), transparent 40%), radial-gradient(circle at 80% 70%, rgba(0,100,255,.4), transparent 40%), linear-gradient(135deg, rgba(0,20,40,.6), rgba(0,10,30,.8))}
    .left-panel::after{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle, rgba(0,255,255,.2), transparent);border-radius:50%;bottom:-150px;right:-150px;filter:blur(80px);animation:pulse 4s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:1;transform:scale(1.1)}}
    .welcome-content{position:relative;z-index:1;text-align:center;color:white}
    .welcome-content h1{font-size:56px;font-weight:700;margin-bottom:20px;line-height:1.2;text-shadow:0 0 20px rgba(0,255,255,.5),2px 2px 8px rgba(0,0,0,.5);color:#fff;letter-spacing:2px}
    .welcome-content h2{font-size:48px;font-weight:600;margin-bottom:30px;text-shadow:0 0 30px rgba(0,255,255,.8),2px 2px 8px rgba(0,0,0,.5);color:#00ffff;letter-spacing:3px}
    .welcome-content p{font-size:20px;line-height:1.8;opacity:.95;max-width:550px;margin:0 auto;text-shadow:0 0 10px rgba(0,255,255,.3);color:#b8e6ff}
    .features{margin-top:40px}.feature-item{font-size:17px;margin:15px 0;opacity:.95;display:flex;align-items:center;justify-content:center;text-shadow:0 0 10px rgba(0,255,255,.3);font-weight:500;color:#b8e6ff}
    .right-panel{flex:1;padding:50px 40px;overflow-y:auto;background:linear-gradient(135deg,#0f1320 0%,#1a1f3a 100%)}
    .form-header{margin-bottom:35px;text-align:center;padding-bottom:25px;border-bottom:2px solid rgba(0,255,255,.2)}
    .form-header h2{font-size:28px;color:#fff;margin-bottom:10px;font-weight:600;text-shadow:0 0 20px rgba(0,255,255,.5);letter-spacing:2px}
    .form-header h3{font-size:20px;color:#00ffff;margin-bottom:15px;font-weight:600;text-shadow:0 0 15px rgba(0,255,255,.6)}
    .form-header p{color:#8ab4d5;font-size:14px;line-height:1.6}
    .form-group{margin-bottom:25px} label{display:block;margin-bottom:8px;color:#b8e6ff;font-weight:500;font-size:14px}
    label .required{color:#00ffff;margin-left:3px}
    input[type="text"],input[type="email"],input[type="tel"],textarea{width:100%;padding:12px 15px;border:2px solid rgba(0,255,255,.2);border-radius:8px;font-size:14px;transition:all .3s ease;font-family:inherit;background:rgba(15,25,45,.8);color:#fff}
    input[readonly]{background:rgba(15,25,45,.5);color:#8ab4d5;cursor:not-allowed;border-color:rgba(0,255,255,.1)}
    textarea{min-height:80px;resize:vertical}
    input:focus:not([readonly]),input[type="email"]:focus,input[type="tel"]:focus,textarea:focus{outline:none;border-color:#00ffff;box-shadow:0 0 20px rgba(0,255,255,.4);background:rgba(15,25,45,.95)}
    input::placeholder,textarea::placeholder{color:rgba(184,230,255,.4)}
    .submit-btn{width:100%;padding:15px;background:linear-gradient(135deg,#00d4ff 0%,#0099ff 50%,#0066ff 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:10px;text-transform:uppercase;letter-spacing:2px;box-shadow:0 4px 20px rgba(0,212,255,.4),0 0 30px rgba(0,255,255,.2);text-shadow:0 0 10px rgba(255,255,255,.5)}
    .submit-btn:hover{transform:translateY(-2px);box-shadow:0 6px 30px rgba(0,212,255,.6),0 0 50px rgba(0,255,255,.4)}
    .submit-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .loading{display:none;text-align:center;margin-top:20px}.loading.active{display:block}
    .spinner{border:3px solid rgba(0,255,255,.2);border-top:3px solid #00ffff;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto;box-shadow:0 0 20px rgba(0,255,255,.3)}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .message{display:none;padding:15px;border-radius:8px;margin-top:20px;text-align:center;font-weight:500}
    .message.success{background:rgba(0,255,200,.15);color:#00ffcc;border:1px solid rgba(0,255,200,.4)}
    .message.error{background:rgba(255,80,80,.15);color:#ff6b6b;border:1px solid rgba(255,80,80,.4)}
    .message.active{display:block}
    .info-text{font-size:12px;color:#6a9ec2;margin-top:5px}
    .event-info-box{background:rgba(0,212,255,.1);border:1px solid rgba(0,255,255,.3);border-radius:8px;padding:20px;margin-bottom:30px}
    .event-info-box h4{color:#00ffff;font-size:18px;margin-bottom:15px;text-align:center;text-shadow:0 0 10px rgba(0,255,255,.5)}
    .event-detail{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(0,255,255,.1)}
    .event-detail:last-child{border-bottom:none}
    .event-detail-label{color:#8ab4d5;font-weight:500}.event-detail-value{color:#fff;font-weight:600}
    @media (max-width:968px){.main-container{flex-direction:column}.left-panel{min-height:300px;padding:40px 30px}.welcome-content h1{font-size:36px}.welcome-content h2{font-size:32px}.welcome-content p{font-size:16px}.right-panel{padding:40px 30px}}
    .right-panel::-webkit-scrollbar{width:8px}.right-panel::-webkit-scrollbar-track{background:rgba(15,19,32,.5)}.right-panel::-webkit-scrollbar-thumb{background:rgba(0,255,255,.3);border-radius:4px}.right-panel::-webkit-scrollbar-thumb:hover{background:rgba(0,255,255,.5)}
  </style>
</head>
<body>
  <div class="main-container">
    <div class="left-panel">
      <div class="welcome-content">
        <h1>Join the</h1>
        <h2>Innovation</h2>
        <p style="font-size:18px;margin-top:20px;margin-bottom:30px;">Register now for CHRIS TECH 2026 and be part of something extraordinary!</p>
        <div class="features">
          <div class="feature-item">Participate in exciting events</div>
          <div class="feature-item">Network with innovators</div>
          <div class="feature-item">Compete for amazing prizes</div>
          <div class="feature-item">Experience cutting-edge technology</div>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="form-header">
        <h2>EVENT REGISTRATION</h2>
        <h3>CHRIS TECH 2026</h3>
        <p>Fill in your details to register for the event. We're excited to have you join us!</p>
      </div>

      <div class="event-info-box" id="eventInfoBox" style="display:none;">
        <h4>ðŸ“… Event Details</h4>
        <div class="event-detail"><span class="event-detail-label">Event Name:</span><span class="event-detail-value" id="displayEventName">-</span></div>
        <div class="event-detail"><span class="event-detail-label">Location:</span><span class="event-detail-value" id="displayLocation">-</span></div>
        <div class="event-detail"><span class="event-detail-label">Date:</span><span class="event-detail-value" id="displayDate">-</span></div>
        <div class="event-detail"><span class="event-detail-label">Time:</span><span class="event-detail-value" id="displayTime">-</span></div>
      </div>

      <form id="eventRegistrationForm">
        <div class="form-group">
          <label for="fullName">Full Name <span class="required">*</span></label>
          <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">
        </div>

        <div class="form-group">
          <label for="email">Email Address <span class="required">*</span></label>
          <input type="email" id="email" name="email" required placeholder="Enter your email address">
          <div class="info-text">We'll send confirmation details to this email</div>
        </div>

        <div class="form-group">
          <label for="contactNumber">Contact Number <span class="required">*</span></label>
          <input type="tel" id="contactNumber" name="contactNumber" required placeholder="Enter your contact number" pattern="[0-9]{10}">
          <div class="info-text">Enter 10-digit mobile number</div>
        </div>

        <div class="form-group">
          <label for="institution">College/School Name <span class="required">*</span></label>
          <input type="text" id="institution" name="institution" required placeholder="Enter your college or school name">
        </div>

        <!-- Hidden fields for event data -->
        <input type="hidden" id="eventName" name="eventName">
        <input type="hidden" id="eventLocation" name="eventLocation">
        <input type="hidden" id="eventDate" name="eventDate">
        <input type="hidden" id="eventTime" name="eventTime">

        <button type="submit" class="submit-btn" id="submitBtn">Register Now</button>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p style="margin-top:10px;color:#00ffff;text-shadow:0 0 10px rgba(0,255,255,.5)">Submitting your registration...</p>
        </div>

        <div class="message" id="message"></div>
      </form>
    </div>
  </div>

  <script>
    // Google Apps Script URL (keep your current value)
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxPis6lpNQN0K5rW5XFtqK3w3Z1h6ctaRfbn8iZ5o1SSDlbrLzvRIr7IKz2iOHgXCR6SQ/exec';

    // Function that sets the event fields and shows the info box
    function setEventParams(params) {
      if (!params) return;
      const decode = (v) => v === null || v === undefined ? '' : decodeURIComponent(String(v));
      const evt = decode(params.event || '');
      const loc = decode(params.location || '');
      const date = decode(params.date || '');
      const time = decode(params.time || '');

      // set hidden inputs
      document.getElementById('eventName').value = evt;
      document.getElementById('eventLocation').value = loc;
      document.getElementById('eventDate').value = date;
      document.getElementById('eventTime').value = time;

      // display for users
      if (evt || loc || date || time) {
        document.getElementById('displayEventName').textContent = evt || '-';
        document.getElementById('displayLocation').textContent = loc || '-';
        document.getElementById('displayDate').textContent = date || '-';
        document.getElementById('displayTime').textContent = time || '-';
        document.getElementById('eventInfoBox').style.display = 'block';
        console.log('Event details set via setEventParams:', {event:evt, location:loc, date:date, time:time});
      } else {
        console.warn('setEventParams called but no values provided');
      }
    }

    // Read params from the iframe's own URL (hash or query) â€” fallback
    function parseSelfUrlParams() {
      const out = { event: '', location: '', date: '', time: '' };
      try {
        if (window.location.hash && window.location.hash.length > 1) {
          const h = window.location.hash.substring(1);
          const hp = new URLSearchParams(h);
          out.event = hp.get('event') || hp.get('event_name') || '';
          out.location = hp.get('location') || hp.get('event_location') || '';
          out.date = hp.get('date') || hp.get('event_date') || '';
          out.time = hp.get('time') || hp.get('event_time') || '';
          if (out.event) { console.log('Parsed params from iframe hash:', h); return out; }
        }
        if (window.location.search && window.location.search.length > 1) {
          const q = new URLSearchParams(window.location.search);
          out.event = q.get('event') || q.get('event_name') || '';
          out.location = q.get('location') || q.get('event_location') || '';
          out.date = q.get('date') || q.get('event_date') || '';
          out.time = q.get('time') || q.get('event_time') || '';
          if (out.event) { console.log('Parsed params from iframe query:', window.location.search); }
        }
      } catch (e) {
        console.warn('Error parsing iframe URL params:', e && e.message);
      }
      return out;
    }

    // Message listener ONLY â€” parent must send params via postMessage
    window.addEventListener('message', function (ev) {
      // DEBUG: show event origin & data
      console.log('Iframe: message event received', ev && ev.origin, ev && ev.data);

      // In production you should verify origin:
      // if (ev.origin !== 'https://www.christech26.com') return;

      if (!ev.data) return;
      const payload = ev.data;

      // Support both direct object and {type:'EVENT_DATA', data: {...}}
      if (payload.type && payload.type === 'EVENT_DATA' && payload.data) {
        setEventParams(payload.data);
      } else if (payload.event || payload.location || payload.date || payload.time) {
        // parent might send raw object
        setEventParams(payload);
      } else {
        console.log('Iframe: received message but no recognizable params');
      }
    }, false);

    // On load: first try self URL params, then wait for parent message
    document.addEventListener('DOMContentLoaded', function () {
      // 1) Try to read params from iframe's own URL (works when parent sets iframe src with query/hash)
      const selfParams = parseSelfUrlParams();
      if (selfParams && (selfParams.event || selfParams.location || selfParams.date || selfParams.time)) {
        setEventParams(selfParams);
      } else {
        console.log('Iframe: no self URL params detected â€” awaiting postMessage from parent');
      }
    });

    // Form submit handling (unchanged)
    (function () {
      const form = document.getElementById('eventRegistrationForm');
      const submitBtn = document.getElementById('submitBtn');
      const loading = document.getElementById('loading');
      const message = document.getElementById('message');

      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        submitBtn.disabled = true;
        loading.classList.add('active');
        message.classList.remove('active');

        const formData = {
          fullName: document.getElementById('fullName').value.trim(),
          email: document.getElementById('email').value.trim(),
          contactNumber: document.getElementById('contactNumber').value.trim(),
          institution: document.getElementById('institution').value.trim(),
          eventName: document.getElementById('eventName').value,
          eventLocation: document.getElementById('eventLocation').value,
          eventDate: document.getElementById('eventDate').value,
          eventTime: document.getElementById('eventTime').value
        };

        console.log('=== SUBMITTING FORM DATA ===', formData);
        try {
          const resp = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(formData),
            headers: { 'Content-Type': 'application/json' } // helpful for Apps Script
          });

          const result = await resp.json();
          console.log('Submission response:', resp.status, result);

          if (result && result.status === 'success') {
            showMessage('Thank you! Your event registration has been submitted successfully.', 'success');
            form.reset();
          } else {
            showMessage((result && result.message) || 'Submission failed. Please try again.', 'error');
          }
        } catch (err) {
          console.error('Submission Error:', err);
          showMessage('Registration submitted! If you dont receive confirmation', 'please contact us.', 'success');
          form.reset();
        } finally {
          submitBtn.disabled = false;
          loading.classList.remove('active');
        }
      });

      function showMessage(text, type) {
        message.textContent = text;
        message.className = 'message ' + type + ' active';
        setTimeout(() => message.classList.remove('active'), 6000);
      }
    })();
  </script>
</body>
</html>
